# -*- coding: utf-8 -*-

# 运行平台: https://www.joinquant.com/

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import bisect

data_config = {
    u'恒生指数' : [
        ['1973-05-31', 43.5],
        ['1973-06-30', 33.1],
        ['1973-07-31', 38.1],
        ['1973-08-31', 31.6],
        ['1973-09-30', 25.6],
        ['1973-10-31', 29.4],
        ['1973-11-30', 24.0],
        ['1973-12-31', 20.2],
        ['1974-01-31', 21.1],
        ['1974-02-28', 16.8],
        ['1974-03-31', 14.1],
        ['1974-04-30', 12.2],
        ['1974-05-31', 16.3],
        ['1974-06-30', 16.1],
        ['1974-07-31', 13.7],
        ['1974-08-31', 11.1],
        ['1974-09-30', 8.7],
        ['1974-10-31', 9.2],
        ['1974-11-30', 7.3],
        ['1974-12-31', 7],
        ['1975-01-31', 9.2],
        ['1975-02-28', 10.5],
        ['1975-03-31', 11.5],
        ['1975-04-30', 12.4],
        ['1975-05-31', 13.3],
        ['1975-06-30', 14.2],
        ['1975-07-31', 13.5],
        ['1975-08-31', 13.2],
        ['1975-09-30', 13.7],
        ['1975-10-31', 13.7],
        ['1975-11-30', 13.8],
        ['1975-12-31', 15.7],
        ['1976-01-31', 17.9],
        ['1976-02-29', 19.1],
        ['1976-03-31', 19.6],
        ['1976-04-30', 17.3],
        ['1976-05-31', 16.9],
        ['1976-06-30', 17.1],
        ['1976-07-31', 16.1],
        ['1976-08-31', 16],
        ['1976-09-30', 15.5],
        ['1976-10-31', 14.3],
        ['1976-11-30', 14.7],
        ['1976-12-31', 16.3],
        ['1977-01-31', 15.8],
        ['1977-02-28', 15],
        ['1977-03-31', 14.4],
        ['1977-04-30', 14.8],
        ['1977-05-31', 14.7],
        ['1977-06-30', 14.7],
        ['1977-07-31', 13.9],
        ['1977-08-31', 13.8],
        ['1977-09-30', 13.3],
        ['1977-10-31', 13.2],
        ['1977-11-30', 13],
        ['1977-12-31', 12.3],
        ['1978-01-31', 12.1],
        ['1978-02-28', 12.1],
        ['1978-03-31', 12.3],
        ['1978-04-30', 12.4],
        ['1978-05-31', 12.8],
        ['1978-06-30', 15.1],
        ['1978-07-31', 15.6],
        ['1978-08-31', 17.9],
        ['1978-09-30', 16.4],
        ['1978-10-31', 17.2],
        ['1978-11-30', 12.7],
        ['1978-12-31', 12.3],
        ['1979-01-31', 13.5],
        ['1979-02-28', 12.8],
        ['1979-03-31', 12],
        ['1979-04-30', 11.7],
        ['1979-05-31', 12.2],
        ['1979-06-30', 11.5],
        ['1979-07-31', 12.8],
        ['1979-08-31', 11.5],
        ['1979-09-30', 13.4],
        ['1979-10-31', 13.2],
        ['1979-11-30', 14.9],
        ['1979-12-31', 16.6],
        ['1980-01-31', 17.8],
        ['1980-02-29', 17],
        ['1980-03-31', 14.3],
        ['1980-04-30', 14.8],
        ['1980-05-31', 15],
        ['1980-06-30', 17.9],
        ['1980-07-31', 19.2],
        ['1980-08-31', 19.2],
        ['1980-09-30', 17.4],
        ['1980-10-31', 20.9],
        ['1980-11-30', 19.5],
        ['1980-12-31', 20.1],
        ['1981-01-31', 21.6],
        ['1981-02-28', 19.8],
        ['1981-03-31', 17.2],
        ['1981-04-30', 16.9],
        ['1981-05-31', 20],
        ['1981-06-30', 20.7],
        ['1981-07-31', 20.3],
        ['1981-08-31', 19.9],
        ['1981-09-30', 13.8],
        ['1981-10-31', 12.9],
        ['1981-11-30', 16.5],
        ['1981-12-31', 16],
        ['1982-01-31', 16.1],
        ['1982-02-28', 14.3],
        ['1982-03-31', 11.9],
        ['1982-04-30', 10.6],
        ['1982-05-31', 11.1],
        ['1982-06-30', 10.2],
        ['1982-07-31', 9.5],
        ['1982-08-31', 8.4],
        ['1982-09-30', 7.4],
        ['1982-10-31', 6.1],
        ['1982-11-30', 5.5],
        ['1982-12-31', 6.2],
        ['1983-01-31', 7],
        ['1983-02-28', 8],
        ['1983-03-31', 8.4],
        ['1983-04-30', 8.6],
        ['1983-05-31', 8],
        ['1983-06-30', 8.4],
        ['1983-07-31', 9.4],
        ['1983-08-31', 8.4],
        ['1983-09-30', 6.7],
        ['1983-10-31', 7.6],
        ['1983-11-30', 7.4],
        ['1983-12-31', 7.6],
        ['1984-01-31', 10.1],
        ['1984-02-29', 9.7],
        ['1984-03-31', 9.9],
        ['1984-04-30', 10.5],
        ['1984-05-31', 9.2],
        ['1984-06-30', 9],
        ['1984-07-31', 7.5],
        ['1984-08-31', 8.8],
        ['1984-09-30', 9.5],
        ['1984-10-31', 10.1],
        ['1984-11-30', 11.2],
        ['1984-12-31', 11.9],
        ['1985-01-31', 13.5],
        ['1985-02-28', 13.6],
        ['1985-03-31', 13.8],
        ['1985-04-30', 16.1],
        ['1985-05-31', 17],
        ['1985-06-30', 16.5],
        ['1985-07-31', 17.5],
        ['1985-08-31', 17.3],
        ['1985-09-30', 15.8],
        ['1985-10-31', 17.2],
        ['1985-11-30', 16.8],
        ['1985-12-31', 16.5],
        ['1986-01-31', 15.9],
        ['1986-02-28', 15.9],
        ['1986-03-31', 13.8],
        ['1986-04-30', 14.9],
        ['1986-05-31', 14.5],
        ['1986-06-30', 14.5],
        ['1986-07-31', 15.4],
        ['1986-08-31', 15.6],
        ['1986-09-30', 16.9],
        ['1986-10-31', 17.4],
        ['1986-11-30', 17.4],
        ['1986-12-31', 19],
        ['1987-01-31', 19.2],
        ['1987-02-28', 21.1],
        ['1987-03-31', 16.8],
        ['1987-04-30', 16.1],
        ['1987-05-31', 17.6],
        ['1987-06-30', 19.4],
        ['1987-07-31', 20.9],
        ['1987-08-31', 21.2],
        ['1987-09-30', 22.3],
        ['1987-10-31', 12.3],
        ['1987-11-30', 11.2],
        ['1987-12-31', 12.1],
        ['1988-01-31', 11.8],
        ['1988-02-29', 12.5],
        ['1988-03-31', 11.6],
        ['1988-04-30', 11.9],
        ['1988-05-31', 11.3],
        ['1988-06-30', 13],
        ['1988-07-31', 13],
        ['1988-08-31', 11.7],
        ['1988-09-30', 11.6],
        ['1988-10-31', 12.3],
        ['1988-11-30', 11.8],
        ['1988-12-31', 12.5],
        ['1989-01-31', 14.2],
        ['1989-02-28', 13.9],
        ['1989-03-31', 12.3],
        ['1989-04-30', 12.8],
        ['1989-05-31', 11.2],
        ['1989-06-30', 9.1],
        ['1989-07-31', 10.3],
        ['1989-08-31', 10],
        ['1989-09-30', 10.9],
        ['1989-10-31', 10.7],
        ['1989-11-30', 10.8],
        ['1989-12-31', 11.1],
        ['1990-01-31', 10.6],
        ['1990-02-28', 11.3],
        ['1990-03-31', 10.3],
        ['1990-04-30', 10.1],
        ['1990-05-31', 10.7],
        ['1990-06-30', 11],
        ['1990-07-31', 11.6],
        ['1990-08-31', 10.4],
        ['1990-09-30', 9.2],
        ['1990-10-31', 9.8],
        ['1990-11-30', 9.7],
        ['1990-12-31', 9.9],
        ['1991-01-31', 10.8],
        ['1991-02-28', 11.8],
        ['1991-03-31', 11.9],
        ['1991-04-30', 11.6],
        ['1991-05-31', 11.8],
        ['1991-06-30', 11.7],
        ['1991-07-31', 12.8],
        ['1991-08-31', 12.6],
        ['1991-09-30', 12.4],
        ['1991-10-31', 12.4],
        ['1991-11-30', 12.6],
        ['1991-12-31', 13.1],
        ['1992-01-31', 14],
        ['1992-02-29', 14.8],
        ['1992-03-31', 13.5],
        ['1992-04-30', 14.8],
        ['1992-05-31', 16.5],
        ['1992-06-30', 16.6],
        ['1992-07-31', 15.9],
        ['1992-08-31', 15.3],
        ['1992-09-30', 14.9],
        ['1992-10-31', 16.4],
        ['1992-11-30', 15],
        ['1992-12-31', 14.2],
        ['1993-01-31', 14.7],
        ['1993-02-28', 16.3],
        ['1993-03-31', 13.2],
        ['1993-04-30', 13.9],
        ['1993-05-31', 14.9],
        ['1993-06-30', 14.4],
        ['1993-07-31', 14],
        ['1993-08-31', 15.2],
        ['1993-09-30', 15.1],
        ['1993-10-31', 17.8],
        ['1993-11-30', 17.2],
        ['1993-12-31', 22.6],
        ['1994-01-31', 21.8],
        ['1994-02-28', 19.6],
        ['1994-03-31', 15],
        ['1994-04-30', 15],
        ['1994-05-31', 15.8],
        ['1994-06-30', 14.4],
        ['1994-07-31', 15.6],
        ['1994-08-31', 16.4],
        ['1994-09-30', 15.6],
        ['1994-10-31', 15.2],
        ['1994-11-30', 13.6],
        ['1994-12-31', 13.1],
        ['1995-01-31', 11.7],
        ['1995-02-28', 12.6],
        ['1995-03-31', 12.6],
        ['1995-04-30', 12.2],
        ['1995-05-31', 13.6],
        ['1995-06-30', 13.3],
        ['1995-07-31', 13.7],
        ['1995-08-31', 13.3],
        ['1995-09-30', 13.9],
        ['1995-10-31', 13.8],
        ['1995-11-30', 13.8],
        ['1995-12-31', 14.1],
        ['1996-01-31', 15.6],
        ['1996-02-29', 14.9],
        ['1996-03-31', 14.1],
        ['1996-04-30', 14.1],
        ['1996-05-31', 14.3],
        ['1996-06-30', 14],
        ['1996-07-31', 13.6],
        ['1996-08-31', 14.1],
        ['1996-09-30', 14.9],
        ['1996-10-31', 16],
        ['1996-11-30', 17.2],
        ['1996-12-31', 17.3],
        ['1997-01-31', 17.1],
        ['1997-02-28', 17.1],
        ['1997-03-31', 14.4],
        ['1997-04-30', 14.9],
        ['1997-05-31', 16.9],
        ['1997-06-30', 17.4],
        ['1997-07-31', 19.2],
        ['1997-08-31', 16.5],
        ['1997-09-30', 17.4],
        ['1997-10-31', 12.2],
        ['1997-11-30', 12],
        ['1997-12-31', 12.2],
        ['1998-01-31', 10.6],
        ['1998-02-28', 12.7],
        ['1998-03-31', 12.5],
        ['1998-04-30', 11.8],
        ['1998-05-31', 9.8],
        ['1998-06-30', 9.4],
        ['1998-07-31', 8.8],
        ['1998-08-31', 8],
        ['1998-09-30', 9.1],
        ['1998-10-31', 12.5],
        ['1998-11-30', 12.8],
        ['1998-12-31', 12.3],
        ['1999-01-31', 11.7],
        ['1999-02-28', 13.1],
        ['1999-03-31', 17.8],
        ['1999-04-30', 21.7],
        ['1999-05-31', 20.7],
        ['1999-06-30', 23.1],
        ['1999-07-31', 22.6],
        ['1999-08-31', 23.1],
        ['1999-09-30', 21.7],
        ['1999-10-31', 22.4],
        ['1999-11-30', 25.5],
        ['1999-12-31', 27.8],
        ['2000-01-31', 25.5],
        ['2000-02-29', 26.1],
        ['2000-03-31', 12.3],
        ['2000-04-30', 11.1],
        ['2000-05-31', 11],
        ['2000-06-30', 12],
        ['2000-07-31', 12.5],
        ['2000-08-31', 13.6],
        ['2000-09-30', 12.4],
        ['2000-10-31', 11.9],
        ['2000-11-30', 11.1],
        ['2000-12-31', 12.7],
        ['2001-01-31', 13.5],
        ['2001-02-28', 12],
        ['2001-03-31', 18.2],
        ['2001-04-30', 17.6],
        ['2001-05-31', 17.4],
        ['2001-06-30', 17.6],
        ['2001-07-31', 15.9],
        ['2001-08-31', 14.3],
        ['2001-09-30', 13],
        ['2001-10-31', 13.3],
        ['2001-11-30', 14.9],
        ['2001-12-31', 15],
        ['2002-01-31', 14.1],
        ['2002-02-28', 13.7],
        ['2002-03-31', 17.8],
        ['2002-04-30', 18.6],
        ['2002-05-31', 18.2],
        ['2002-06-30', 17.1],
        ['2002-07-31', 16.6],
        ['2002-08-31', 16.2],
        ['2002-09-30', 14.7],
        ['2002-10-31', 15.4],
        ['2002-11-30', 16.4],
        ['2002-12-31', 15.4],
        ['2003-01-31', 15.3],
        ['2003-02-28', 15.1],
        ['2003-03-31', 13.1],
        ['2003-04-30', 13.3],
        ['2003-05-31', 14.6],
        ['2003-06-30', 14.8],
        ['2003-07-31', 15.6],
        ['2003-08-31', 17],
        ['2003-09-30', 17.6],
        ['2003-10-31', 19.2],
        ['2003-11-30', 19.4],
        ['2003-12-31', 19.8],
        ['2004-01-31', 20.9],
        ['2004-02-29', 21.7],
        ['2004-03-31', 18.2],
        ['2004-04-30', 17.1],
        ['2004-05-31', 17.5],
        ['2004-06-30', 17.5],
        ['2004-07-31', 17.4],
        ['2004-08-31', 18.3],
        ['2004-09-30', 18.4],
        ['2004-10-31', 18.3],
        ['2004-11-30', 19.7],
        ['2004-12-31', 19.9],
        ['2005-01-31', 19.2],
        ['2005-02-28', 19.8],
        ['2005-03-31', 15.1],
        ['2005-04-30', 15.2],
        ['2005-05-31', 15.2],
        ['2005-06-30', 15.8],
        ['2005-07-31', 16.6],
        ['2005-08-31', 16.6],
        ['2005-09-30', 16],
        ['2005-10-31', 14.7],
        ['2005-11-30', 15.3],
        ['2005-12-31', 15.2],
        ['2006-01-31', 16.1],
        ['2006-02-28', 16.2],
        ['2006-03-31', 12.7],
        ['2006-04-30', 13.3],
        ['2006-05-31', 12.7],
        ['2006-06-30', 13.1],
        ['2006-07-31', 13.6],
        ['2006-08-31', 14.1],
        ['2006-09-30', 13.9],
        ['2006-10-31', 14.6],
        ['2006-11-30', 15.1],
        ['2006-12-31', 15.8],
        ['2007-01-31', 15.9],
        ['2007-02-28', 15.5],
        ['2007-03-31', 15],
        ['2007-04-30', 15.3],
        ['2007-05-31', 15.6],
        ['2007-06-30', 16.5],
        ['2007-07-31', 17.6],
        ['2007-08-31', 18.1],
        ['2007-09-30', 21.1],
        ['2007-10-31', 24.2],
        ['2007-11-30', 22.1],
        ['2007-12-31', 21],
        ['2008-01-31', 17.7],
        ['2008-02-29', 18.3],
        ['2008-03-31', 14],
        ['2008-04-30', 15.5],
        ['2008-05-31', 14.7],
        ['2008-06-30', 13.4],
        ['2008-07-31', 13.8],
        ['2008-08-31', 12.7],
        ['2008-09-30', 10.7],
        ['2008-10-31', 8.2],
        ['2008-11-30', 8.2],
        ['2008-12-31', 8.5],
        ['2009-01-31', 7.8],
        ['2009-02-28', 7.6],
        ['2009-03-31', 11.2],
        ['2009-04-30', 12.9],
        ['2009-05-31', 15.1],
        ['2009-06-30', 15.2],
        ['2009-07-31', 17],
        ['2009-08-31', 16.7],
        ['2009-09-30', 18.4],
        ['2009-10-31', 19.4],
        ['2009-11-30', 19.5],
        ['2009-12-31', 19.5],
        ['2010-01-31', 18],
        ['2010-02-28', 18.3],
        ['2010-03-31', 16.6],
        ['2010-04-30', 16.5],
        ['2010-05-31', 15.5],
        ['2010-06-30', 15.9],
        ['2010-07-31', 16.1],
        ['2010-08-31', 15.8],
        ['2010-09-30', 16.7],
        ['2010-10-31', 17],
        ['2010-11-30', 16.9],
        ['2010-12-31', 17],
        ['2011-01-31', 17.3],
        ['2011-02-28', 17.1],
        ['2011-03-31', 12.5],
        ['2011-04-30', 12.6],
        ['2011-05-31', 12.6],
        ['2011-06-30', 12.1],
        ['2011-07-31', 12.1],
        ['2011-08-31', 11.3],
        ['2011-09-30', 9.6],
        ['2011-10-31', 10.8],
        ['2011-11-30', 9.8],
        ['2011-12-31', 10.1],
        ['2012-01-31', 11.2],
        ['2012-02-29', 11.6],
        ['2012-03-31', 10.5],
        ['2012-04-30', 9.9],
        ['2012-05-31', 8.8],
        ['2012-06-30', 9.3],
        ['2012-07-31', 9.4],
        ['2012-08-31', 9.3],
        ['2012-09-30', 9.9],
        ['2012-10-31', 10.3],
        ['2012-11-30', 10.5],
        ['2012-12-31', 10.8],
        ['2013-01-31', 11.3],
        ['2013-02-28', 10.8],
        ['2013-03-31', 10.8],
        ['2013-04-30', 11],
        ['2013-05-31', 10.8],
        ['2013-06-30', 10.1],
        ['2013-07-31', 10.6],
        ['2013-08-31', 10.5],
        ['2013-09-30', 11.1],
        ['2013-10-31', 11.3],
        ['2013-11-30', 11.6],
        ['2014-02-28', 10.9],
        ['2014-03-31', 10.3],
        ['2014-04-30', 10.3],
        ['2014-05-31', 10.7],
        ['2014-06-30', 10.7],
        ['2014-07-31', 11.5],
        ['2014-08-31', 11.5],
        ['2014-09-30', 10.8],
        ['2014-10-31', 11.3],
        ['2014-11-30', 11.2],
        ['2014-12-31', 11],
        ['2015-01-31', 11.4],
        ['2015-02-28', 10.8],
        ['2015-03-31', 10.6],
        ['2015-04-30', 11.9],
        ['2015-05-31', 11.5],
        ['2015-06-30', 10.8],
        ['2015-07-31', 10.1],
        ['2015-08-31', 8.9],
        ['2015-09-30', 8.5],
        ['2015-10-31', 9.2],
        ['2015-11-30', 9],
        ['2015-12-31', 8.8],
        ['2016-01-31', 8],
        ['2016-02-29', 7.9],
        ['2016-03-31', 10.1],
        ['2016-04-30', 10.3],
        ['2016-05-31', 10.2],
        ['2016-06-30', 10.3],
        ['2016-07-29', 10.8],
        ['2016-08-31', 11.4],
        ['2016-09-30', 11.5],
        ['2016-10-31', 11.3],
        ['2016-11-30', 11.3],
    ],

    u'恒生国企指数' : [
        ['2001-10-31', 6], 
        ['2001-11-30', 6.5],
        ['2001-12-31', 6.4],
        ['2002-01-31', 7],
        ['2002-02-28', 7.3],
        ['2002-03-31', 7.3],
        ['2002-04-30', 9.5],
        ['2002-05-31', 9.8],
        ['2002-06-30', 10],
        ['2002-07-31', 9.4],
        ['2002-08-31', 8.9],
        ['2002-09-30', 8.7],
        ['2002-10-31', 8.4],
        ['2002-11-30', 8.8],
        ['2002-12-31', 9.2],
        ['2003-01-31', 10],
        ['2003-02-28', 10.1],
        ['2003-03-31', 9.2],
        ['2003-04-30', 9],
        ['2003-05-31', 10.1],
        ['2003-06-30', 11.2],
        ['2003-07-31', 12.4],
        ['2003-08-31', 13.7],
        ['2003-09-30', 13.3],
        ['2003-10-31', 15.9],
        ['2003-11-30', 15.8],
        ['2003-12-31', 20.7],
        ['2004-01-31', 19],
        ['2004-02-29', 21],
        ['2004-03-31', 14.6],
        ['2004-04-30', 13.9],
        ['2004-05-31', 14.8],
        ['2004-06-30', 14.2],
        ['2004-07-31', 14.3],
        ['2004-08-31', 14.2],
        ['2004-09-30', 15.4],
        ['2004-10-31', 14.8],
        ['2004-11-30', 16.3],
        ['2004-12-31', 15.5],
        ['2005-01-31', 15.5],
        ['2005-02-28', 17.1],
        ['2005-03-31', 11.3],
        ['2005-04-30', 10.2],
        ['2005-05-31', 10.1],
        ['2005-06-30', 10.7],
        ['2005-07-31', 11.6],
        ['2005-08-31', 11.2],
        ['2005-09-30', 11.6],
        ['2005-10-31', 10.5],
        ['2005-11-30', 11.1],
        ['2005-12-31', 11.8],
        ['2006-01-31', 13.8],
        ['2006-02-28', 14.1],
        ['2006-03-31', 14.2],
        ['2006-04-30', 14],
        ['2006-05-31', 13.8],
        ['2006-06-30', 14],
        ['2006-07-31', 14.1],
        ['2006-08-31', 14.2],
        ['2006-09-30', 14.4],
        ['2006-10-31', 15.3],
        ['2006-11-30', 17.5],
        ['2006-12-31', 21.3],
        ['2007-01-31', 19.8],
        ['2007-02-28', 19.2],
        ['2007-03-31', 18.6],
        ['2007-04-30', 18.5],
        ['2007-05-31', 19.8],
        ['2007-06-30', 22.1],
        ['2007-07-31', 24.6],
        ['2007-08-31', 26.4],
        ['2007-09-30', 31.4],
        ['2007-10-31', 36.1],
        ['2007-11-30', 31.8],
        ['2007-12-31', 29.8],
        ['2008-01-31', 23.1],
        ['2008-02-29', 25.8],
        ['2008-03-31', 18.1],
        ['2008-04-30', 18.8],
        ['2008-05-31', 18.1],
        ['2008-06-30', 15.7],
        ['2008-07-31', 16.5],
        ['2008-08-31', 15.4],
        ['2008-09-30', 12],
        ['2008-10-31', 9.5],
        ['2008-11-30', 9.5],
        ['2008-12-31', 10.5],
        ['2009-01-31', 9.4],
        ['2009-02-28', 9.1],
        ['2009-03-31', 11.5],
        ['2009-04-30', 14.2],
        ['2009-05-31', 16.3],
        ['2009-06-30', 17.1],
        ['2009-07-31', 18.9],
        ['2009-08-31', 17.6],
        ['2009-09-30', 18.4],
        ['2009-10-31', 19.8],
        ['2009-11-30', 20.1],
        ['2009-12-31', 19.8],
        ['2010-01-31', 17.8],
        ['2010-02-28', 17.9],
        ['2010-03-31', 17],
        ['2010-04-30', 15.8],
        ['2010-05-31', 15],
        ['2010-06-30', 15.2],
        ['2010-07-31', 15.8],
        ['2010-08-31', 15.1],
        ['2010-09-30', 16.5],
        ['2010-10-31', 17.5],
        ['2010-11-30', 17],
        ['2010-12-31', 16.9],
        ['2011-01-31', 16.7],
        ['2011-02-28', 16.6],
        ['2011-03-31', 12.9],
        ['2011-04-30', 12.6],
        ['2011-05-31', 12.7],
        ['2011-06-30', 12],
        ['2011-07-31', 11.8],
        ['2011-08-31', 10.5],
        ['2011-09-30', 8.5],
        ['2011-10-31', 10.1],
        ['2011-11-30', 9.1],
        ['2011-12-31', 9.5],
        ['2012-01-31', 10.8],
        ['2012-02-29', 11.3],
        ['2012-03-31', 9.3],
        ['2012-04-30', 9.3],
        ['2012-05-31', 8.1],
        ['2012-06-30', 8.1],
        ['2012-07-31', 8.2],
        ['2012-08-31', 7.8],
        ['2012-09-30', 8.1],
        ['2012-10-31', 8.8],
        ['2012-11-30', 8.8],
        ['2012-12-31', 9.5],
        ['2013-01-31', 10.1],
        ['2013-02-28', 9.5],
        ['2013-03-31', 9],
        ['2013-04-30', 9],
        ['2013-05-31', 8.7],
        ['2013-06-30', 7.7],
        ['2013-07-31', 7.9],
        ['2013-08-31', 8.1],
        ['2013-09-30', 8.4],
        ['2013-10-31', 8.7],
        ['2013-11-30', 9.4],
        ['2013-12-31', 8.8],
        ['2014-01-31', 8],
        ['2014-02-28', 8],
        ['2014-03-31', 7.5],
        ['2014-04-30', 7.2],
        ['2014-05-31', 7.6],
        ['2014-06-30', 7.7],
        ['2014-07-31', 8.4],
        ['2014-08-31', 8.2],
        ['2014-09-30', 7.6],
        ['2014-10-31', 7.9],
        ['2014-11-30', 8.2],
        ['2014-12-31', 8.9],
        ['2015-01-31', 8.8],
        ['2015-02-28', 9.1],
        ['2015-03-31', 8.8],
        ['2015-04-30', 10.3],
        ['2015-05-31', 10.1],
        ['2015-06-30', 9.4],
        ['2015-07-31', 8.1],
        ['2015-08-31', 7.1],
        ['2015-09-30', 6.8],
        ['2015-10-31', 7.5],
        ['2015-11-30', 7.1],
        ['2015-12-31', 7],
        ['2016-01-31', 6],
        ['2016-02-29', 5.8],
        ['2016-03-31', 7],
        ['2016-04-30', 7],
        ['2016-05-31', 6.8],
        ['2016-06-30', 6.8],
        ['2016-07-29', 7],
        ['2016-08-31', 7.5],
        ['2016-09-30', 7.6],
        ['2016-10-31', 7.5],
        ['2016-11-30', 7.8],
    ],
}
    
#指数历史PEPB
def get_index_pe_pb(config):
    dates = []
    pes = []
    average_pes = []
    for pair in config:
        pe = pair[-1]
        if pe > 0.0 :   
            pes.append(pe)
            average_pes.append(sum(pes) / len(pes))
            dates.append(pair[0])
    d = {
        'PE' : pd.Series(pes, index = dates),
        'AVERAGE_PE' : pd.Series(average_pes, index = dates),
    }
    PB_PE = pd.DataFrame(d)
    return PB_PE


df_pe_pb = pd.DataFrame()
frames = pd.DataFrame()
today = pd.datetime.today()
pe_config = [11.2, 7.7]
pe_index = 0
for index_name, config in data_config.items() :
    print '正在处理: %s' % index_name
    results = []
    df_pe_pb = get_index_pe_pb(config)        
    pe = pe_config[pe_index]
    pe_index += 1

    q_pes = [df_pe_pb['PE'].quantile(i / 10.0) for i in range(11)]    
    index_pe = bisect.bisect(q_pes, pe)
    if index_pe <= 0:
        quantile_pe = 0
    elif index_pe < len(q_pes):
        quantile_pe = index_pe - (q_pes[index_pe] - pe) / (q_pes[index_pe] - q_pes[index_pe - 1])
    else:
        quantile_pe = 10   
    results.append(
        [
            index_name, 
            today.strftime('%Y-%m-%d'), 
            '%.2f' % pe, 
            '%.2f' % df_pe_pb['AVERAGE_PE'][-1], 
            '%.2f' % (quantile_pe * 10)
        ] + 
        ['%.2f' % q for q in q_pes] + [df_pe_pb['PE'].count()]
    )
     
    df_pe_pb['10% PE'] = q_pes[1]
    df_pe_pb['30% PE'] = q_pes[3]
    df_pe_pb['50% PE'] = q_pes[5]
    df_pe_pb['90% PE'] = q_pes[9]
    df_pe_pb.plot(figsize = (18, 10),
                  title = index_name,
                  style = ['m', 'k', 'g', 'c', 'y', 'r'])
    columns = [u'名称', u'当前日期', u'当前估值', u'平均估值', u'分位点%', u'最小估值'] + \
        ['%d%%' % (i * 10) for i in range(1, 10)] + [u'最大估值' , u"数据个数"]
    df = pd.DataFrame(data = results, index = ['PE'], columns = columns)
    frames = pd.concat([frames, df])

frames
